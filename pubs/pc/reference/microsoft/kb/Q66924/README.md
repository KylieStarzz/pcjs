---
layout: page
title: "Q66924: extern _based(_segname) May Define Segment of Class CODE"
permalink: /pubs/pc/reference/microsoft/kb/Q66924/
---

## Q66924: extern _based(_segname) May Define Segment of Class CODE

	Article: Q66924
	Version(s): 6.00 6.00a | 6.00 6.00a
	Operating System: MS-DOS     | OS/2
	Flags: ENDUSER | buglist6.00 buglist6.00a
	Last Modified: 18-NOV-1990
	
	When using the _based keyword to declare data, if the data is declared
	externally, the "/Fc" listing and .OBJ file may incorrectly define the
	segment as class 'CODE'.
	
	Sample Code
	-----------
	
	// file1.c
	
	char _based(_segname("STORAGE")) achar1;
	extern char _based(_segname("STORAG1")) achar2;
	extern char _based(_segname("STORAG2")) achar3;
	char _based(_segname("STORAG2")) achar4;
	
	void main(void) {}
	
	// file2.c
	
	char _based(_segname("STORAG1")) achar2;
	
	The /Fc listing for file1.c declares the _based segments as follows:
	
	STORAGE SEGMENT WORD PUBLIC 'FAR_DATA'
	STORAG1 SEGMENT WORD PUBLIC 'CODE'
	STORAG2 SEGMENT WORD PUBLIC 'FAR_DATA'
	
	The .OBJ file for file1 will contain a SEGDEF (SEGment DEFinition)
	record defining STORAG1 as a class CODE segment. However, there is no
	PUBDEF (PUBlic DEFinition) record to confuse the linker. In the .OBJ
	file for file2, there is a SEGDEF record defining STORAG1 as a class
	'FAR_DATA' segment, AND a PUBDEF record for the linker to resolve the
	external reference of achar2 in file1. Therefore, although there will
	be an extra segment (of zero length) defined in the final .EXE, there
	will be no detrimental effects to this problem.
	
	If there is another variable defined in file1.c that is initialized
	and is also based on a named segment, the invalid SEGment DEFinition
	will not be generated by the compiler. The above example with the
	STORAG2 segment illustrates this.
	
	This is only a problem with the full optimizing compiler. The Quick
	Compiler (/qc option) works correctly.
	
	Microsoft has confirmed this to be a problem in Microsoft C version
	6.00 and 6.00A. We are researching this problem and will post new
	information here as it becomes available.
