---
layout: page
title: "Q10826: Limitations on Writing Device Drivers in C"
permalink: /pubs/pc/reference/microsoft/kb/Q10826/
---

## Q10826: Limitations on Writing Device Drivers in C

	Article: Q10826
	Version(s): 4.00 5.00 5.10 6.00 6.00a
	Operating System: MS-DOS
	Flags: ENDUSER | s_quickc
	Last Modified: 14-DEC-1990
	
	Question:
	
	I am writing an MS-DOS device driver. All of the code is written in
	Microsoft C, with the exception of the standard device driver header
	(which is written in assembly language). Can all of a device driver be
	written in C?
	
	Response:
	
	You cannot write complete device drivers in C. You must write some
	parts in assembly, and you cannot use the majority of the C run-time
	library support.
	
	These are the major problems in using C for device drivers:
	
	1. The .EXE loader is in COMMAND.COM, and therefore, not available to
	   load device drivers. In this case, the device driver must be a
	   binary image of a single-segment program. The C compiler does not
	   generate such code. At best, in small model, you have two disjoint
	   physical segments [one for code (CS) and one for data (SS AND DS)].
	
	2. The C run-time initialization code depends on the PSP being set up
	   properly and it relies on DOS being available. Although, the
	   start-up source is provided, it is mainly assembly code and it will
	   require major modifications.
	
	3. The entry-exit sequences for C functions are not appropriate for
	   being called as a DOS driver.
	
	You can work around some of these limitations by using assembly code
	generated by the C compiler. The -Fa switch will direct the compiler
	to output assembler source. This assembler source code then can be
	edited and used as part of the driver source. Depending on the
	complexity of the DOS driver, it is possible that most of the driver
	could be written in C and still provide for reasonably easy
	modification and maintenance.
